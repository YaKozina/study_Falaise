#@description SuperNEMO demonstrator official reconstruction pipeline (version1.1.0)  
#@key_label  "name"                                                             
#@meta_label "type"

###########################################
# FLRECONSTRUCT PLUGINS
###########################################

[name="flreconstruct.plugins" type="flreconstruct::section"]

plugins : string[1] = "Falaise_TKReconstruct" 

Falaise_TKReconstruct.directory    : string = "/sps/nemo/scratch/ykozina/Falaise/tutorial/CimrmanModule/build"
	
###########################################
# FLRECONSTRUCT CORE
###########################################

[name="flreconstruct" type="flreconstruct::section"]
experimentalSetupURN : string = "urn:snemo:demonstrator:setup:2.0"

[name="flreconstruct.variantService" type="flreconstruct::section"]
profile : string as path = "/sps/nemo/scratch/ykozina/Falaise/tutorial/CalibrationTools/build/CalibrationCutsModule/variant.profile" 

###########################################
# PIPELINE
###########################################

[name="pipeline" type="dpp::chain_module"]
modules : string[3] = "udd2pcd" "pcd2cd" "TKReconstruct" 


###########################################
# UDD to pCD
###########################################

[name="udd2pcd" type="snemo::processing::udd2pcd_module"]
  logging.priority : string = "fatal"
  UDD_label : string = "UDD"
  pCD_label : string = "pCD"
  calo_adc2volt : real = 6.103516e-4
  calo_sampling_frequency_ghz : real = 2.56
  calo_postrigger_ns : real = 25.0
  calo_baseline_nsamples : integer = 16
  calo_charge_integration_nsamples : integer = 992
  calo_charge_integration_nsamples_before_peak : integer = 64
  calo_time_cfd_ratio : real = 0.25
  calo_discard_empty_waveform : boolean = true
  calo_method : string = "fwmeas"
  tracker_method : string = "basic_cluster"

###########################################
# pCD to CD
###########################################

[name="pcd2cd" type="snemo::processing::pcd2cd_module"]
  logging.priority : string = "notice"
  pCD_label : string = "pCD"
  CD_label : string = "CD"
 # calo_energy_method : string = "pol0_table"
 # calo_energy_method.database : string = "/sps/nemo/scratch/granjon/full_gain_analysis/Bi/root/compute_a/calibration_phase_1.txt"
  calo_time_method : string = "t0_table"
  calo_time_method.database : string = "/sps/nemo/scratch/granjon/UDD-2-PTD/calo-t0-fwmeas-manu-v2-normalised.txt"
  tracker_radius_method : string = "manu"
  tracker_height_method : string = "linear_r5r6"


###########################################
# Cimrman 
###########################################

[name="TKReconstruct" type="TKReconstruct"]
verbosity : string = "debug"
CD_label  : string = "CD"
TCD_label : string = "TCD"
TTD_label : string = "TTD"

eventrec.verbosity : string = "debug"
eventrec.mode : string = "electron_kinked"
eventrec.visualization : boolean = false
eventrec.save_sinograms : boolean = false
eventrec.force_default_sigma_r : boolean = false
eventrec.default_sigma_r : real as length = 2.0 mm
eventrec.chi_square_threshold : real = 5.0

eventrec.clustering_max_distance : real as length = 130.0 mm
eventrec.clustering_hit_association_distance : real as length = 6.0 mm
eventrec.clustering_no_iterations : integer = 2
eventrec.clustering_resolution_phi : integer = 100
eventrec.clustering_resolution_r : integer = 250
eventrec.clustering_max_initial_precision_r : real as length = 6.0 mm
eventrec.clustering_zoom_factor : real = 10.0
eventrec.clustering_uncertainty : real as length = 2.0 mm

eventrec.polylines_max_extention_distance : real as length = 120.0 mm
eventrec.polylines_max_vertical_distance : real as length = 40.0 mm
eventrec.polylines_min_tracker_hits_distance : real as length = 100.0 mm
eventrec.polylines_max_kink_angle : real = 120.0
eventrec.polylines_max_trajectories_middlepoint_distance : real as length = 10.0 mm
eventrec.polylines_max_trajectory_endpoints_distance : real as length = 75.0 mm 
eventrec.polylines_max_trajectory_connection_angle : real = 40
eventrec.polylines_min_distance_from_foil : real as length = 75.0 mm

#end
