#@description SuperNEMO demonstrator official reconstruction pipeline (version1.1.0)  
#@key_label  "name"                                                             
#@meta_label "type"

###########################################
# FLRECONSTRUCT PLUGINS
###########################################

[name="flreconstruct.plugins" type="flreconstruct::section"]

plugins : string[2] = "Falaise_TKReconstruct" "Falaise_ChargedParticleTracking" 

Falaise_TKReconstruct.directory    : string = "/sps/nemo/scratch/ykozina/Falaise/tutorial/CimrmanModule/build"
	
###########################################
# FLRECONSTRUCT CORE
###########################################

[name="flreconstruct" type="flreconstruct::section"]
experimentalSetupURN : string = "urn:snemo:demonstrator:setup:2.0"


###########################################
# PIPELINE
###########################################

[name="pipeline" type="dpp::chain_module"]
modules : string[2] = "TKReconstruct" "ChargedParticleTracker"


###########################################
# Cimrman (+TTD to existing pCD & TCD)
###########################################

[name="TKReconstruct" type="TKReconstruct"]
verbosity : string = "debug"
CD_label  : string = "CD"
TCD_label : string = "TCD"
TTD_label : string = "TTD"

eventrec.verbosity : string = "debug"
eventrec.mode : string = "electron_kinked"
eventrec.visualization : boolean = false
eventrec.save_sinograms : boolean = false
eventrec.force_default_sigma_r : boolean = false
eventrec.default_sigma_r : real as length = 2.0 mm
eventrec.chi_square_threshold : real = 5.0

eventrec.clustering_max_distance : real as length = 130.0 mm
eventrec.clustering_hit_association_distance : real as length = 6.0 mm
eventrec.clustering_no_iterations : integer = 2
eventrec.clustering_resolution_phi : integer = 100
eventrec.clustering_resolution_r : integer = 250
eventrec.clustering_max_initial_precision_r : real as length = 6.0 mm
eventrec.clustering_zoom_factor : real = 10.0
eventrec.clustering_uncertainty : real as length = 2.0 mm

eventrec.polylines_max_extention_distance : real as length = 120.0 mm
eventrec.polylines_max_vertical_distance : real as length = 40.0 mm
eventrec.polylines_min_tracker_hits_distance : real as length = 100.0 mm
eventrec.polylines_max_kink_angle : real = 120.0
eventrec.polylines_max_trajectories_middlepoint_distance : real as length = 10.0 mm
eventrec.polylines_max_trajectory_endpoints_distance : real as length = 75.0 mm 
eventrec.polylines_max_trajectory_connection_angle : real = 40
eventrec.polylines_min_distance_from_foil : real as length = 75.0 mm

###########################################
# +PTD 
###########################################


[name="ChargedParticleTracker" type="snemo::reconstruction::charged_particle_tracking_module"]
  #@config Parameters for the Charged Particle Tracking module
  Geo_label : string  = "geometry"
  drivers : string[4] = "VED" "CCD" "CAD" "AFD"
  
    # Additional (optional) parameters for the VED driver (Vertex Extrapolation Driver):
    # VED.logging.priority : string = "debug"
    # VED.finder.step         : real as length = 2.0 cm  # default value
    # VED.intercept.tolerance : real as length = 1.0 mm  # default value
    # VED.max_calo_extrapolation.xy_length   : real as length = 15.0 cm  # default value
    # VED.max_source_extrapolation.xy_length : real as length = 20.0 cm  # default value
    # VED.max_source_extrapolation.z_length  : real as length = 30.0 cm  # default value
    # VED.calo_extrapolation.horizontal_tolerance : real as length = 25.0 mm  # default value
    # VED.calo_extrapolation.vertical_tolerance : real as length   = 30.0 mm  # default value
    # VED.calibration_source_extrapolation.extend_horizontal : real as length = 10.0 mm  # default value
    # VED.calibration_source_extrapolation.extend_vertical   : real as length = 20.0 mm  # default value
    # VED.line_extrapolation : boolean = true # default value
    # VED.helix_extrapolation : boolean = true # default value
    # VED.source_extrapolation.cone_angle : real as angle = 5.0 degree # default value
    # VED.source_extrapolation.cone_nrays : integer = 6 # default value
    # VED.source_extrapolation.cone_nlayers : integer = 1 # default value


    # Additional (optional) parameters for the AFD driver (Alpha particle Finder Driver):
    AFD.minimal_delayed_time : real as time = 13 us



#end
